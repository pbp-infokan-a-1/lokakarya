<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>Admin Dashboard</h1>

    <!-- Store Management Section -->
    <h2>Store Management</h2>
    <form id="store-form">
        {% csrf_token %}
        <input type="text" id="store-name" name="name" placeholder="Store Name" required>
        <input type="text" id="store-openDays" name="openDays" placeholder="Open Days" required>
        <textarea id="store-address" name="address" placeholder="Store Address" required></textarea>
        <input type="email" id="store-email" name="email" placeholder="Store Email" required>
        <input type="text" id="store-phone" name="phone" placeholder="Store Phone" required>
        <label for="store-product">Products:</label>
        <select id="store-product" name="product" multiple>
            <!-- Dynamically populated product options -->
        </select>
        <button type="submit">Add Store</button>
    </form>

    <div id="store-list">
        <!-- Stores will be displayed here -->
    </div>

    <!-- Product Management Section -->
    <h2>Product Management</h2>
    <form id="product-form" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="text" id="product-name" name="name" placeholder="Product Name" required>
        <textarea id="product-description" name="description" placeholder="Description" required></textarea>
        <input type="number" id="product-price" name="price" placeholder="Price" step="0.01" required>
        <input type="file" id="product-image" name="image">
        <input type="text" id="product-category" name="category" placeholder="Category" required>
        <input type="number" id="product-rating" name="rating" placeholder="Rating" step="0.01" required>
        <input type="number" id="product-num_reviews" name="num_reviews" placeholder="Number of Reviews" required>
        <label for="product-store">Stores:</label>
        <select id="product-store" name="store" multiple>
            <!-- Dynamically populated store options -->
        </select>
        <button type="submit">Add Product</button>
    </form>

    <div id="product-list">
        <!-- Products will be displayed here -->
    </div>

    <script>
        function renderStore(store) {
            return `
                <div id="store-${store.id}">
                    <h3>${store.name}</h3>
                    <p>Open Days: ${store.openDays}</p>
                    <p>Address: ${store.address}</p>
                    <p>Email: ${store.email}</p>
                    <p>Phone: ${store.phone}</p>
                    <button onclick="editStore(${store.id})">Edit Store</button>
                    <button onclick="deleteStore(${store.id})">Delete Store</button>
                </div>
            `;
        }

        function renderProduct(product) {
            return `
                <div id="product-${product.id}">
                    <h3>${product.name}</h3>
                    <p>Description: ${product.description}</p>
                    <p>Price: ${product.price}</p>
                    <p>Categories: ${product.categories.join(', ')}</p>
                    <p>Rating: ${product.rating}</p>
                    <p>Number of Reviews: ${product.num_reviews}</p>
                    <img src="${product.image}" alt="${product.name}" style="max-width: 100px;">
                    <button onclick="editProduct(${product.id})">Edit Product</button>
                    <button onclick="deleteProduct(${product.id})">Delete Product</button>
                </div>
            `;
        }

        function loadStores() {
            $.get('/stores/', function(response) {
                $('#store-list').empty();
                response.stores.forEach(function(store) {
                    $('#store-list').append(renderStore(store));
                });
                populateStoreOptions(response.stores);
            });
        }

        function loadProducts() {
            $.get('/products/', function(response) {
                $('#product-list').empty();
                response.products.forEach(function(product) {
                    $('#product-list').append(renderProduct(product));
                });
                populateProductOptions(response.products);
            });
        }

        function populateStoreOptions(stores) {
            $('#product-store').empty();
            stores.forEach(function(store) {
                $('#product-store').append(new Option(store.name, store.id));
            });
        }

        function populateProductOptions(products) {
            $('#store-product').empty();
            products.forEach(function(product) {
                $('#store-product').append(new Option(product.name, product.id));
            });
        }

        $('#store-form').submit(function(e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/stores/create/',
                data: $(this).serialize(),
                success: function(response) {
                    if (response.status === 'success') {
                        loadStores();
                        $('#store-form')[0].reset();
                    }
                }
            });
        });

        $('#product-form').submit(function(e) {
            e.preventDefault();
            var formData = new FormData(this);
            $.ajax({
                type: 'POST',
                url: '/products/create/',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.status === 'success') {
                        loadProducts();
                        $('#product-form')[0].reset();
                    }
                },
                error: function(xhr) {
                    alert('Error: ' + xhr.responseText);
                }
            });
        });

        function editStore(storeId) {
            // Similar implementation as before
        }

        function editProduct(productId) {
            // Similar implementation as before
        }

        function deleteStore(storeId) {
            // Similar implementation as before
        }

        function deleteProduct(productId) {
            // Similar implementation as before
        }

        // Initial load
        loadStores();
        loadProducts();
    </script>
</body>
</html>
